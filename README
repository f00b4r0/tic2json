Licence: GPLv2 - http://www.gnu.org/licenses/gpl-2.0.html
Copyright: (C) 2021 Thibaut VARENE

tic2json: an ENEDIS TIC protocol parser and converter

 This program is free software; you can redistribute it and/or
 modify it under the terms of the GNU General Public License
 version 2, as published by the Free Software Foundation.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

More info: http://hacks.slashdirt.org/sw/tic2json/

Dependencies: gcc flex bison

To build, run 'make'

Note: the build can be adjusted through the top Makefile variables.
In particular, it is possible to build support for only specific version(s) of the TIC.

Implementing other types of outputs (XML, etc) should be trivial given the implementation.

TIC output from electronic meters is either:
 - 7E1@1200bps for "historique" mode
 - 7E1@9600bps for "standard" mode

The current implementation supports TIC version 01 and 02.

A tty interfaced to the meter TIC output can be set using the following `stty`
settings:

stty -F <serial_tty> <speed> raw evenp

Where <serial_tty> is the target tty (e.g. /dev/ttyS0) and <speed> is either 1200 or 9600.

For reference, the output of this tool is suitable for feeding a Telegraf 'socket_listener' configured as follows:

[[inputs.socket_listener]]
  service_address = "udp://:8094"
  data_format = "json"
  json_strict = true
  json_name_key = "label"
  tag_keys = ["id"]

The following command line can be used to send adequate data:
stdbuf -oL ./tic2json -2 < /dev/ttyS0 2>/dev/null | while read line; do echo "$line" | nc -q 0 -u telegraf_host 8094; done
